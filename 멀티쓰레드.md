# 멀티쓰레드
    하나의 프로세스 내에서 여러개 의 쓰레드를 동시에 실행하는 기술
    병렬처리를 통해 성능향상이 가능함

### 프로세스
- 실행중인 프로그램의 인스턴스
- 독립된 메모리 공간을 가짐

### 쓰레드
- 프로세스 내에서 실행되는 작은 실행 단위
- 독립적으로 실행됨
- 동일한 메모리 공간를 공유
### 멀티쓰레딩
- 하나의 프로세스에서 여러개의 쓰레드를 가지고 있고 쓰레드를 독립적으로 실행 같은 메모리를 공유하기 때문에 서로 통신이 원활하다.

### 장점
- 병렬성
    - 여러작업을 동시에 진행할 수 있음, 때문에 처리속도 향상
- 효율적인 자원 활용
    -   멀티쓰레딩을 이용해서 CPU사용량을 극대화할 수 있음
- 멀티프로세스의 생성 및 컨덱트스 스위칭 보다 ***멀티프로세스의 생성 및 컨텍스트 스위칭이 더 빠름***

### 단점
- 잘못된 값 읽어오기
    - 멀티 쓰레드는 데이터와 힙영역을 공유하기 때문에 잘못된 데이터를 읽어올 수 있음
- 복잡성 증가
    - 멀티쓰레딩 프로그래밍은 디버그,테스트 및 유지보수가 힘듬
    - 쓰레드간 교착 상태를 관리해주어야함

- 동기화 오버헤드
    - 스레드 간 데이터 접근을 조율하기위해서 동기화 작업이 필요함, 성능저하 가능성이 있음 ( 병목현상 )

- 컨텍스트 스위칭 오버헤드
    -  CPU가 쓰레드를 스위칭할 때 시간이 걸리기 때문에 오히려 많은 쓰레드를 사용할 경우 성능저하가 있을 수 있음

### 성능 저하
- 데드락
- 경쟁상태

## 주요개념
1. 동기화
    - 여러 쓰레드가 하나의 메모리에 접근하기 때문에 데이터의 일관성을 유지하기 위해서 사용
    - 뮤텍스 , 세마포어 , 락
2. 교착상태 ( DeadLock )
    - 두 개 이상의 쓰레드가 서로필요하는 데이터를 점유하고 있어서 더이상 진행할수 없는 상태
        - A에서는 b라는 데이터를 사용중이고 a의 데이터를 원함
        - B에서는 a라는 데이터를 사용중이고 b의 데이터를 원함
        - 서로가 점유중인 데이터를 원하기 때문에 데이터를 접근하기위해 무한 대기 할 것임
    
3. 경쟁 상태 ( Race Condition )
    - 현재 작업이 제어할 수 없는 또다른 작업과의 진행 순서에 따라 결과가 달라져 여러 결과를 만들어낼 수 있는 바람직하지 않은 상황
    - 두 개 이상의 쓰레드가 동시에 같은 자원을 접근하려고 할 때 예기치 못한 상황이 발생하는 상황
    - 적당한 동기화 작업이 필요함

4. 스레드 풀 ( Thread pool )
    - 많은 수의 단기 작업을 처리할 때 사용되는 기법
    - 미리 생성된 쓰레드 집합을 이용해서 처리
    - 쓰레드를 재사용함으로서 자원 사용을 최적화 할 수 있음


## 뮤텍스
멀티쓰레드 환경에서 공유자원에 대한 접근을 제어하기 위한 도구

- Lock & Unlock
    - Lock : 쓰레드가 임계영역에 접근할 때 다른 쓰레드가 접근하지 못하도록 잠금
        - 다른 쓰레드들은 이 락이 풀릴 때 까지 대기하게 됨
    - Unlock : 쓰레드가 임계영역에서 나올 때 락을 해제
        - 대기중인 다른 쓰레드가 접근을 할 수 있게 됨

- 임계영역
    - 여러쓰레드가 동시에 접근하면 안되는 공유자원에 접근하려고 하는 코드블록
    - 임계영역을 락해서 하나의 쓰레드만 접근 할 수 있도록 해야함

- 교착 상태
    - 두개 이상의 쓰레드가 서로가 필요로하는 락을 획득한 상태에서 대기하는 상황
        - 이를 방지하기 위해 타임아웃을 설정하거나 순서를 정해줄수 있음

## 세마포어
특정 자원에 접근을 제한하여 자원에 접근하려는 쓰레드 수를 제어 동시에 접근하려는 쓰레드 수를 제어함으로서 데이터의 일관성을 유지

- 내부적으로 카운터를 가지고 있음
    - 카운터는 접근할 수 있는 쓰레드의 최대 수
- 카운터 값이 0보다 크면 접근가능하며 접근시 1씩 뺍니다.
- 카운터가 0이면 다른 쓰레드는 대기상태가 됨 카운터가 증가할 때까지 대기함

### P연산
카운터가 0보다 크면 세마포어를 감소시켜 자원을 획득

카운터가 0이면 자원이 해제될 때까지 대기함

### V연산
카운터를 증가시켜 자원을 해제함

대기 중인 쓰레드가 깨어날수 있게 함

### 장점
- 동시성 제어 : 자원에 접근하는 쓰레드를 제한하여 동시성을 효과적으로 제어
- 유연성 : 카운터 값을 조정하여 다양한 상황에 맞게 사용가능
- 교착 상태 방지 : 여러개의 쓰레드가 접근가능하기에 잘 설계하면 교착상태를 방지할수 있음

### 단점
- 복잡성 증가
- 디버깅이 어려움
- 성능 저하

# 쓰레드간 통신 ( IPC )
쓰레드간 통신 ( Inter-Process Communication )은 주로 프로세스간의 통신을 의미하지마 이는 쓰레드에서도 사용가능하다.

대표적인 방법으로는 ***전역변수와 락***, ***queue*** , ***pipe*** , ***Socket*** , ***공유메모리*** 등이 있다.

1. 전역변수
    
     메모리를 사용 쓰레드들은 메모리를 공유하기제 접근이 가능 하지만 데드락이나 다른 문제를 피하기위해 락을 사용하는 것이 좋음

2. Queue

    FIFO의 구조를 가지고 있으며 한 쓰레드가 데이터를 넣어놓으면 다른 쓰레드가 꺼내가는 방식

    - 쓰레드간 데이터를 안전하게 전달 가능

3. 공유메모리

    여러 쓰레드나 프로세스가 공통으로 사용하는 메모리 영역을 사용하여 데이터를 주고 받음

    - 매우 빠름 , 큰 데이터를 옮기는데 사용됨

# 쓰레드 풀
쓰레드의 생성과 소멸이 자주 일어나게 된다면 시스템에 큰 부하를 줄 수 있음 때문에 한번만 일을 수행하고 소멸되면 매우 비효율적임

생성과 소멸이 성능적으로 많이 부담이 되므로 쓰레드 풀을 유지하는게 성능향상에 많은 도움이됨 

    할당된 일을 다한 쓰레드를 소멸시키지 않고 저장해 두었다가 다른 일을 씨키는 것

쓰레드를 제한해서 사용하기 때문에 쓰레드가 무제한으로 생성되어 시스템이 제대로 동작할 수 있도록 함

미리 생성 해놓기 떄문에 처리속도가 올라감

너무 많이 생성한다고 좋지 않음 


# 레이스 컨디션 , 데이터 레이스
멀티쓰레드 등을 이용한 동시성 프로그래밍을 하다보면 동시에 한 메모리 영역에 접근할 때 읽기/쓰기에 있어서 데이터가 꼬이는 상황이 발생할 수 있음 이런 상황을 레이스 컨디션과 데이터 레이스와 같이 표현함
## 레이스 컨디션
현재 작업이 제어할 수 없는 또다른 작업과의 진행 순서에 따라 결과가 달라져 여러 결과를 만들어낼 수 있는 바람직하지 않은 상황
- 순서대로 값을 출력해야하는 경우나 순서가 실행결과에 영향을 미치는 경우 레이스 컨디션이 발생할 수 있음

## 데이터 레이스
다른 곳에서 읽을 가능성이 있는 어떤 메모리 위치에 쓰기 작업을 하는 것
- 매우 위험한 상황을 의미